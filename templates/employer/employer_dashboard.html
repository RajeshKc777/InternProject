{% extends "extend/base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12 mb-4">
            <h2 class="fw-bold">Employer Dashboard</h2>
        </div>
    </div>

    <!-- Overview Cards -->
    <div class="row g-4 mb-4">
        <!-- Workspace Overview -->
        <div class="col-12 col-md-4">
            <div class="card">
                <div class="card-body py-4">
                    <h5 class="mb-2 fw-bold">Workspace Overview</h5>
                    <p class="mb-2">Task Progress</p>
                    <div class="mb-0">
                        <span class="fw-bold text-primary">
                            {{ workspace.get_tasks.count }} Total Tasks
                        </span>
                        <div class="progress mt-2" style="height: 5px;">
                            <div class="progress-bar bg-success" role="progressbar" 
                                 style="width: {{ completion_rate }}%" 
                                 aria-valuenow="{{ completion_rate }}" 
                                 aria-valuemin="0" 
                                 aria-valuemax="100"></div>
                        </div>
                        <small class="text-muted">{{ completion_rate }}% Complete</small>
                    </div>
                    <a href="{% url 'personal_workspace' %}" class="btn btn-primary btn-sm mt-3">View Workspace</a>
                </div>
            </div>
        </div>

        <!-- Performance Reviews -->
        <div class="col-12 col-md-4">
            <div class="card">
                <div class="card-body py-4">
                    <h5 class="mb-2 fw-bold">Performance Reviews</h5>
                    <p class="mb-2">Recent Reviews</p>
                    <div class="mb-0">
                        <span class="fw-bold text-success">
                            {{ performance_reviews|length }} Reviews
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Goals Progress -->
        <div class="col-12 col-md-4">
            <div class="card">
                <div class="card-body py-4">
                    <h5 class="mb-2 fw-bold">Goals Progress</h5>
                    <p class="mb-2">Assigned Goals</p>
                    <div class="mb-0">
                        <span class="fw-bold text-primary">
                            {{ goals|length }} Goals ({{ goals_completed }} Completed)
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Tasks Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title mb-4">Recent Tasks</h5>
                    <div class="row">
                        <!-- In Progress Tasks -->
                        <div class="col-md-4">
                            <h6 class="mb-3 fw-bold">In Progress</h6>
                            {% for task in in_progress_tasks %}
                            <div class="task-item mb-3 p-3 border rounded">
                                <h6>{{ task.title }}</h6>
                                <p class="small text-muted mb-2">{{ task.description|truncatechars:100 }}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="badge bg-primary">{{ task.priority }}</span>
                                    <small class="text-muted">Due: {{ task.deadline|date:"M d, Y" }}</small>
                                </div>
                                <div class="progress mt-2" style="height: 5px;">
                                    <div class="progress-bar" role="progressbar" 
                                         style="width: {{ task.progress }}%" 
                                         aria-valuenow="{{ task.progress }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100"></div>
                                </div>
                            </div>
                            {% empty %}
                            <p class="text-muted">No tasks in progress</p>
                            {% endfor %}
                        </div>

                        <!-- Completed Tasks -->
                        <div class="col-md-4">
                            <h6 class="mb-3 fw-bold">Completed</h6>
                            {% for task in completed_tasks %}
                            <div class="task-item mb-3 p-3 border rounded">
                                <h6>{{ task.title }}</h6>
                                <p class="small text-muted mb-2">{{ task.description|truncatechars:100 }}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="badge bg-success">Completed</span>
                                    <small class="text-muted">Completed: {{ task.updated_at|date:"M d, Y" }}</small>
                                </div>
                            </div>
                            {% empty %}
                            <p class="text-muted">No completed tasks</p>
                            {% endfor %}
                        </div>

                        <!-- Missed Tasks -->
                        <div class="col-md-4">
                            <h6 class="mb-3 fw-bold">Missed</h6>
                            {% for task in missed_tasks %}
                            <div class="task-item mb-3 p-3 border rounded">
                                <h6>{{ task.title }}</h6>
                                <p class="small text-muted mb-2">{{ task.description|truncatechars:100 }}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="badge bg-danger">Missed</span>
                                    <small class="text-muted">Due: {{ task.deadline|date:"M d, Y" }}</small>
                                </div>
                            </div>
                            {% empty %}
                            <p class="text-muted">No missed tasks</p>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="text-center mt-3">
                        <a href="{% url 'personal_workspace' %}" class="btn btn-primary">View All Tasks</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Reviews Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title mb-4">Recent Performance Reviews</h5>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Productivity</th>
                                    <th>Punctuality</th>
                                    <th>Collaboration</th>
                                    <th>Feedback</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for review in performance_reviews %}
                                <tr>
                                    <td>{{ review.date|date:"M d, Y" }}</td>
                                    <td>{{ review.productivity_score }}</td>
                                    <td>{{ review.punctuality_score }}</td>
                                    <td>{{ review.collaboration_score }}</td>
                                    <td>{{ review.feedback|truncatechars:50 }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5" class="text-center">No reviews available</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Goals Section -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title mb-4">Your Goals</h5>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Status</th>
                                    <th>Progress</th>
                                    <th>Deadline</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for goal in goals %}
                                <tr>
                                    <td>{{ goal.title }}</td>
                                    <td>
                                        <span class="badge {% if goal.status == 'completed' %}bg-success{% elif goal.status == 'in_progress' %}bg-warning{% else %}bg-danger{% endif %}">
                                            {{ goal.status|title }}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="progress" style="height: 5px;">
                                            <div class="progress-bar" role="progressbar" 
                                                 style="width: {{ goal.progress }}%" 
                                                 aria-valuenow="{{ goal.progress }}" 
                                                 aria-valuemin="0" 
                                                 aria-valuemax="100"></div>
                                        </div>
                                        <small>{{ goal.progress }}%</small>
                                    </td>
                                    <td>{{ goal.deadline|date:"M d, Y" }}</td>
                                    <td>
                                        <a href="{% url 'task_detail' goal.id %}" class="btn btn-sm btn-primary">View Details</a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="5" class="text-center">No goals assigned</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}